<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Indian Rashi Time Finder | Vedic Astronomical Calculator</title>
    <meta name="description" content="Calculate the active Vedic Rashi (Lagna) based on Earth's 24-hour rotation. Modern Indian Panchang-inspired astronomical tool.">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        :root {
            --bg-deep: #020617;
            --accent-primary: #6366f1;
            --accent-secondary: #a855f7;
            --glass-bg: rgba(255, 255, 255, 0.04);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: var(--bg-deep);
            color: #f8fafc;
            overflow-x: hidden;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        /* Animated Star Background */
        #star-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.3s ease;
        }

        @media (min-width: 1024px) {
            .glass-panel:hover {
                border-color: rgba(99, 102, 241, 0.4);
            }
        }

        .rashi-gradient-text {
            background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .timeline-container::-webkit-scrollbar {
            height: 4px;
        }
        .timeline-container::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 10px;
        }

        .active-rashi-glow {
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.4);
        }

        input[type="date"], input[type="time"], select {
            color-scheme: dark;
            font-size: 16px !important;
            z-index: 20; 
            position: relative;
        }

        /* Fixed Sticky Button for Mobile with focus logic */
        @media (max-width: 768px) {
            .mobile-sticky-btn {
                position: fixed;
                bottom: 20px;
                left: 20px;
                right: 20px;
                z-index: 100;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
                transition: transform 0.3s ease, opacity 0.3s ease;
            }
            .mobile-sticky-btn.btn-hidden {
                transform: translateY(120%);
                opacity: 0;
                pointer-events: none;
            }
            .form-container {
                padding-bottom: 20px;
            }
            .content-padding {
                padding-bottom: 120px;
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary:active:not(:disabled) {
            transform: scale(0.95);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(0.5);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #334155;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px; width: 18px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); }
        input:checked + .slider:before { transform: translateX(26px); }

        .symbol-glow {
            text-shadow: 0 0 15px rgba(168, 85, 247, 0.6);
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-10 content-padding">

    <canvas id="star-canvas"></canvas>

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8 md:mb-16">
            <h1 class="text-3xl sm:text-5xl lg:text-7xl font-extrabold mb-3 md:mb-6 rashi-gradient-text italic tracking-tight">
                Indian Rashi Time Finder
            </h1>
            <p class="text-slate-400 text-sm sm:text-lg lg:text-2xl font-light max-w-2xl mx-auto px-4">
                Discover the <span class="text-indigo-400 font-medium">Lagna</span> (Ascendant) rising on the horizon right now.
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-10">
            <!-- Left Column: Inputs -->
            <section class="lg:col-span-4 xl:col-span-4 space-y-6">
                <div class="glass-panel p-5 sm:p-8 rounded-[2rem] form-container">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg sm:text-xl font-semibold flex items-center">
                            <svg class="w-5 h-5 mr-2 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            Controls
                        </h2>
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] uppercase font-bold tracking-widest text-slate-500">Live Mode</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="live-mode-toggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <form id="calc-form" class="space-y-4 sm:space-y-6">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4">
                            <div>
                                <label class="block text-xs uppercase tracking-widest text-slate-500 mb-2 ml-1">Date</label>
                                <input type="date" id="input-date" required
                                    class="input-field w-full bg-slate-900/60 border border-slate-700/50 rounded-2xl px-4 py-4 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all disabled:opacity-30 disabled:cursor-not-allowed">
                            </div>

                            <div>
                                <label class="block text-xs uppercase tracking-widest text-slate-500 mb-2 ml-1">Time</label>
                                <input type="time" id="input-time" required
                                    class="input-field w-full bg-slate-900/60 border border-slate-700/50 rounded-2xl px-4 py-4 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all disabled:opacity-30 disabled:cursor-not-allowed">
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs uppercase tracking-widest text-slate-500 mb-2 ml-1">Timezone (GMT Offset)</label>
                            <select id="input-tz" 
                                class="input-field w-full bg-slate-900/60 border border-slate-700/50 rounded-2xl px-4 py-4 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 appearance-none transition-all disabled:opacity-30">
                                <option value="5.5">India (GMT +5:30)</option>
                                <option value="0">UTC (GMT 0)</option>
                                <option value="-5">USA East (GMT -5)</option>
                                <option value="8">Singapore (GMT +8)</option>
                                <option value="1">Europe (GMT +1)</option>
                            </select>
                        </div>
                    </form>

                    <!-- Sticky Button Moved Outside Form to prevent layout overlap -->
                    <div id="sticky-btn-wrapper" class="mobile-sticky-btn md:mt-8">
                        <button type="submit" form="calc-form" id="calc-btn" class="w-full btn-primary py-4 sm:py-5 rounded-2xl font-bold text-white uppercase tracking-widest text-sm shadow-xl">
                            <span>Calculate Rashi</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Right Column: Results -->
            <section id="results-area" class="lg:col-span-8 xl:col-span-8 space-y-6 hidden animate-fade-in">
                <div class="glass-panel p-6 sm:p-10 lg:p-12 rounded-[2.5rem] active-rashi-glow relative overflow-hidden">
                    <div id="hero-symbol-bg" class="absolute -top-4 -right-4 p-8 opacity-5 lg:opacity-10 pointer-events-none text-[150px] sm:text-[250px] font-serif"></div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center gap-3">
                            <span class="text-indigo-400 text-xs sm:text-sm font-bold tracking-[0.2em] uppercase">Current Ascendant (Lagna)</span>
                            <span id="live-indicator" class="hidden px-2 py-0.5 rounded-full bg-red-500/20 text-red-400 text-[10px] font-bold animate-pulse">LIVE</span>
                        </div>
                        <div class="flex flex-col mt-4">
                            <div class="flex items-center gap-4">
                                <span id="active-rashi-symbol" class="text-4xl sm:text-6xl text-purple-400 symbol-glow"></span>
                                <h2 id="active-rashi-display" class="text-4xl sm:text-6xl lg:text-7xl font-black tracking-tighter"></h2>
                            </div>
                            <span id="active-rashi-sanskrit" class="text-2xl sm:text-4xl text-slate-400 italic font-light mt-2"></span>
                        </div>
                        
                        <div class="mt-10 pt-10 border-t border-slate-800/50 grid grid-cols-2 md:grid-cols-4 gap-6">
                            <div class="col-span-1">
                                <span class="block text-[10px] sm:text-xs text-slate-500 uppercase tracking-widest mb-1">Ends at</span>
                                <span id="next-change-time" class="text-lg sm:text-2xl font-mono text-purple-400 font-medium">--:--</span>
                            </div>
                            <div class="col-span-1">
                                <span class="block text-[10px] sm:text-xs text-slate-500 uppercase tracking-widest mb-1">Next Sign</span>
                                <span id="next-rashi-name" class="text-lg sm:text-2xl text-slate-200 font-medium">---</span>
                            </div>
                            <div class="hidden md:block col-span-1">
                                <span class="block text-[10px] sm:text-xs text-slate-500 uppercase tracking-widest mb-1">Element</span>
                                <span id="rashi-element-hero" class="text-lg sm:text-2xl text-slate-200 font-medium">---</span>
                            </div>
                            <div class="hidden md:block col-span-1">
                                <span class="block text-[10px] sm:text-xs text-slate-500 uppercase tracking-widest mb-1">Ruler</span>
                                <span id="rashi-ruler-hero" class="text-lg sm:text-2xl text-slate-200 font-medium">---</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-panel p-6 sm:p-8 rounded-[2.5rem]">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg sm:text-xl font-bold">24-Hour Cycle</h3>
                        <span class="text-[10px] sm:text-xs font-medium text-slate-500 uppercase tracking-widest bg-slate-900 px-3 py-1 rounded-full">120m intervals</span>
                    </div>
                    <div id="timeline-scroll" class="flex lg:grid lg:grid-cols-4 xl:grid-cols-6 gap-3 sm:gap-4 overflow-x-auto lg:overflow-visible pb-4 lg:pb-0 timeline-container"></div>
                </div>
            </section>

            <!-- Empty State -->
            <div id="empty-state" class="lg:col-span-8 flex flex-col items-center justify-center p-12 sm:p-20 glass-panel rounded-[2.5rem] border-dashed border-slate-700/50">
                <div class="w-20 h-20 bg-slate-900 rounded-full flex items-center justify-center mb-6 shadow-inner">
                    <svg class="w-10 h-10 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </div>
                <h3 class="text-xl font-medium text-slate-300 mb-2">Ready to Calculate</h3>
                <p class="text-slate-500 text-center max-w-xs">Select a date and time or enable Live Mode to reveal the active Rashi.</p>
            </div>
        </div>

        <footer class="mt-20 py-10 text-center border-t border-slate-900/50">
            <p class="text-slate-600 text-xs sm:text-sm tracking-widest uppercase">&copy; 2024 Indian Rashi Time Finder &bull; Sidereal Calculation Engine</p>
        </footer>
    </div>

    <script>
        const RASHIS = [
            { id: 0, hindi_en: "Mesh", en: "Aries", symbol: "♈", sk: "मेष", element: "Fire", ruler: "Mars" },
            { id: 1, hindi_en: "Vrishabh", en: "Taurus", symbol: "♉", sk: "वृषभ", element: "Earth", ruler: "Venus" },
            { id: 2, hindi_en: "Mithun", en: "Gemini", symbol: "♊", sk: "मिथुन", element: "Air", ruler: "Mercury" },
            { id: 3, hindi_en: "Karka", en: "Cancer", symbol: "♋", sk: "कर्क", element: "Water", ruler: "Moon" },
            { id: 4, hindi_en: "Singh", en: "Leo", symbol: "♌", sk: "सिंह", element: "Fire", ruler: "Sun" },
            { id: 5, hindi_en: "Kanya", en: "Virgo", symbol: "♍", sk: "कन्या", element: "Earth", ruler: "Mercury" },
            { id: 6, hindi_en: "Tula", en: "Libra", symbol: "♎", sk: "तुला", element: "Air", ruler: "Venus" },
            { id: 7, hindi_en: "Vrishchik", en: "Scorpio", symbol: "♏", sk: "वृश्चिक", element: "Water", ruler: "Mars" },
            { id: 8, hindi_en: "Dhanu", en: "Sagittarius", symbol: "♐", sk: "धनु", element: "Fire", ruler: "Jupiter" },
            { id: 9, hindi_en: "Makar", en: "Capricorn", symbol: "♑", sk: "मकर", element: "Earth", ruler: "Saturn" },
            { id: 10, hindi_en: "Kumbh", en: "Aquarius", symbol: "♒", sk: "कुंभ", element: "Air", ruler: "Saturn" },
            { id: 11, hindi_en: "Meen", en: "Pisces", symbol: "♓", sk: "मीन", element: "Water", ruler: "Jupiter" }
        ];

        const stickyBtn = document.getElementById('sticky-btn-wrapper');
        const inputs = document.querySelectorAll('.input-field');

        inputs.forEach(el => {
            el.addEventListener('focus', () => {
                if (window.innerWidth < 768) stickyBtn.classList.add('btn-hidden');
            });
            el.addEventListener('blur', () => {
                setTimeout(() => {
                    stickyBtn.classList.remove('btn-hidden');
                }, 150);
            });
        });

        const canvas = document.getElementById('star-canvas');
        const ctx = canvas.getContext('2d');
        let stars = [];
        let isMobile = window.innerWidth < 768;

        function initStars() {
            isMobile = window.innerWidth < 768;
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            stars = [];
            const starCount = isMobile ? 80 : 250;
            for(let i=0; i<starCount; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * (isMobile ? 1.2 : 1.8),
                    opacity: Math.random(),
                    speed: Math.random() * 0.03 + 0.01
                });
            }
        }

        function animateStars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stars.forEach(s => {
                s.opacity += s.speed;
                if(s.opacity > 1 || s.opacity < 0) s.speed = -s.speed;
                ctx.fillStyle = `rgba(255, 255, 255, ${Math.abs(s.opacity)})`;
                ctx.beginPath();
                ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
                ctx.fill();
            });
            requestAnimationFrame(animateStars);
        }

        function getLagna(dateObj) {
            const start = new Date(dateObj.getFullYear(), 0, 0);
            const diff = dateObj - start;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);
            const localMinutes = (dateObj.getHours() * 60) + dateObj.getMinutes();
            let dailyShift = (dayOfYear - 80) * 3.9426;
            let zodiacMinutes = (localMinutes + dailyShift) % 1440;
            if (zodiacMinutes < 0) zodiacMinutes += 1440;
            return { index: Math.floor(zodiacMinutes / 120) % 12, minsRemaining: 120 - (zodiacMinutes % 120) };
        }

        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
        }

        let liveInterval = null;

        function toggleLiveMode(isLive) {
            const fieldIds = ['input-date', 'input-time', 'input-tz'];
            const btn = document.getElementById('calc-btn');
            const indicator = document.getElementById('live-indicator');

            if (isLive) {
                fieldIds.forEach(id => document.getElementById(id).disabled = true);
                btn.disabled = true;
                indicator.classList.remove('hidden');
                runCalculation();
                liveInterval = setInterval(runCalculation, 60000);
            } else {
                fieldIds.forEach(id => document.getElementById(id).disabled = false);
                btn.disabled = false;
                indicator.classList.add('hidden');
                if (liveInterval) clearInterval(liveInterval);
            }
        }

        function runCalculation(e) {
            if (e) e.preventDefault();
            const isLive = document.getElementById('live-mode-toggle').checked;
            let targetDate;

            if (isLive) {
                targetDate = new Date();
                document.getElementById('input-date').value = targetDate.toISOString().split('T')[0];
                document.getElementById('input-time').value = targetDate.toTimeString().slice(0, 5);
            } else {
                const dateStr = document.getElementById('input-date').value;
                const timeStr = document.getElementById('input-time').value;
                targetDate = new Date(`${dateStr}T${timeStr}`);
            }

            if (isNaN(targetDate)) return;

            const { index, minsRemaining } = getLagna(targetDate);
            const active = RASHIS[index];
            const next = RASHIS[(index + 1) % 12];

            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('results-area').classList.remove('hidden');

            document.getElementById('active-rashi-symbol').innerText = active.symbol;
            document.getElementById('hero-symbol-bg').innerText = active.symbol;
            document.getElementById('active-rashi-display').innerHTML = 
                `${active.hindi_en} <span class="text-slate-500 font-light text-2xl sm:text-4xl lg:text-5xl">(${active.en})</span>`;
            document.getElementById('active-rashi-sanskrit').innerText = active.sk;
            
            const nextDate = new Date(targetDate.getTime() + minsRemaining * 60000);
            document.getElementById('next-change-time').innerText = formatTime(nextDate);
            document.getElementById('next-rashi-name').innerText = next.hindi_en;

            document.getElementById('rashi-element-hero').innerText = active.element;
            document.getElementById('rashi-ruler-hero').innerText = active.ruler;

            const timeline = document.getElementById('timeline-scroll');
            timeline.innerHTML = '';

            for (let i = 0; i < 12; i++) {
                const rIdx = (index + i) % 12;
                const rData = RASHIS[rIdx];
                const startTime = new Date(targetDate.getTime() + (i === 0 ? 0 : (i * 120 - (120 - minsRemaining)) * 60000));
                
                const card = document.createElement('div');
                card.className = `min-w-[140px] sm:min-w-0 p-4 sm:p-5 rounded-2xl sm:rounded-3xl text-center border transition-all ${i === 0 ? 'bg-indigo-600/30 border-indigo-500 ring-2 ring-indigo-500/20' : 'bg-slate-900/40 border-slate-800 lg:opacity-70 lg:hover:opacity-100'}`;
                
                card.innerHTML = `
                    <div class="text-[9px] sm:text-[10px] uppercase font-bold tracking-widest ${i === 0 ? 'text-indigo-300' : 'text-slate-500'} mb-2">
                        ${i === 0 ? 'ACTIVE NOW' : formatTime(startTime)}
                    </div>
                    <div class="text-2xl mb-1">${rData.symbol}</div>
                    <div class="font-bold text-sm sm:text-lg text-slate-100">${rData.hindi_en}</div>
                    <div class="text-[10px] sm:text-xs text-slate-400 italic">${rData.sk} (${rData.en})</div>
                `;
                timeline.appendChild(card);
            }

            if(!isLive && window.innerWidth < 1024 && e) {
                document.getElementById('results-area').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        window.addEventListener('resize', initStars);
        window.onload = () => {
            initStars();
            animateStars();
            const now = new Date();
            document.getElementById('input-date').value = now.toISOString().split('T')[0];
            document.getElementById('input-time').value = now.toTimeString().slice(0, 5);
            document.getElementById('calc-form').addEventListener('submit', runCalculation);
            document.getElementById('live-mode-toggle').addEventListener('change', (e) => toggleLiveMode(e.target.checked));
            runCalculation();
        };
    </script>
</body>
</html>